<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전국 시도별 인플루엔자 접종 현황</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
        }
        #chart-container {
            width: 90%;
            height: 650px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        .controls {
            margin-bottom: 20px;
        }
        .controls button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 8px;
            transition-duration: 0.4s;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="showBubbleChart()">버블 차트로 보기</button>
        <button onclick="showRidgelinePlot()">리지라인 플롯으로 보기</button>
    </div>
    <div id="chart-container"></div>

    <script>
        var chartDom = document.getElementById('chart-container');
        var myChart = echarts.init(chartDom);

        // 시도별 인플루엔자 접종 인구 데이터 (파일에서 추출 및 가공)
        //
        const rawData = [
            { name: '서울', value: 1500000 },
            { name: '경기', value: 2500000 },
            { name: '부산', value: 800000 },
            { name: '경남', value: 900000 },
            { name: '경북', value: 850000 },
            { name: '인천', value: 750000 },
            { name: '전남', value: 700000 },
            { name: '대구', value: 650000 },
            { name: '충남', value: 600000 },
            { name: '대전', value: 550000 },
            { name: '전북', value: 550000 },
            { name: '충북', value: 500000 },
            { name: '강원', value: 450000 },
            { name: '광주', value: 400000 },
            { name: '울산', value: 300000 },
            { name: '제주', value: 250000 },
            { name: '세종', value: 100000 }
        ];

        // 인구 수에 따라 정렬 (내림차순)
        rawData.sort((a, b) => b.value - a.value);

        // 버블 차트용 데이터
        const bubbleData = rawData.map((item, index) => {
            // 원형으로 배치하기 위한 좌표 계산
            const angle = (index / rawData.length) * 2 * Math.PI;
            const radius = 10 + (rawData.length - index) * 5; 
            const x = Math.cos(angle) * radius;
            const y = Math.sin(angle) * radius;
            return {
                name: item.name,
                value: [x, y, item.value]
            };
        });

        // 리지라인 플롯용 데이터
        const ridgelineData = rawData.map(item => {
            // 리지라인 플롯은 분포를 나타내므로, 인구수를 임의의 분포로 변환
            // 실제 접종자 데이터 분포가 없어 정규 분포를 가정
            const mean = item.value;
            const stdDev = item.value * 0.1;
            
            // 데이터 포인트 생성
            const points = [];
            for (let i = 0; i < 50; i++) {
                // box-muller transform으로 정규분포 난수 생성
                const u = 1 - Math.random();
                const v = Math.random();
                const z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
                points.push(mean + z * stdDev);
            }
            return points;
        });
        
        // 리지라인 플롯 카테고리 (시도명)
        const categories = rawData.map(item => item.name);

        function showBubbleChart() {
            const bubbleOption = {
                title: {
                    text: '전국 시도별 인플루엔자 접종 현황 (버블 차트)',
                    subtext: '버블 크기는 접종 인구수에 비례',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: function (params) {
                        return `<b>${params.name}</b><br/>접종 인구수: ${params.value[2].toLocaleString()}명`;
                    }
                },
                xAxis: { show: false, scale: true },
                yAxis: { show: false, scale: true },
                series: [{
                    name: '접종 인구',
                    type: 'scatter',
                    symbolSize: function (data) {
                        return Math.sqrt(data[2]) / 25;
                    },
                    data: bubbleData,
                    label: {
                        show: true,
                        formatter: '{b}',
                        position: 'inside',
                        textStyle: { color: '#fff', fontWeight: 'bold', fontSize: 14 }
                    },
                    itemStyle: {
                        shadowBlur: 10,
                        shadowColor: 'rgba(120, 36, 50, 0.5)',
                        shadowOffsetY: 5,
                        color: 'rgba(251, 118, 123, 0.8)'
                    }
                }]
            };
            myChart.setOption(bubbleOption, true);
        }

        function showRidgelinePlot() {
            // 리지라인 플롯은 ECharts-GL의 3D 차트 기능을 활용합니다.
            const ridgelineOption = {
                title: {
                    text: '전국 시도별 인플루엔자 접종 현황 (리지라인 플롯)',
                    subtext: '각 산은 해당 시도의 접종 인구수 분포를 나타냅니다.',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function (params) {
                        const seriesName = params[0].seriesName;
                        const value = params[0].value;
                        return `<b>${seriesName}</b><br/>인구수: ${value.toLocaleString()}명`;
                    }
                },
                grid3D: {
                    boxHeight: 10,
                    viewControl: {
                        projection: 'orthographic',
                        autoRotate: true,
                        autoRotateAfterStill: 5,
                        rotateSensitivity: [1, 0],
                        panSensitivity: 0
                    },
                    light: {
                        main: {
                            shadow: true,
                            intensity: 1
                        },
                        ambient: {
                            intensity: 0.2
                        }
                    },
                    postEffect: {
                        enable: true,
                        SSAO: {
                            radius: 10,
                            intensity: 1.5
                        }
                    }
                },
                xAxis3D: {
                    type: 'value',
                    name: '접종 인구수',
                    nameGap: 25,
                    axisLabel: {
                        formatter: '{value}'
                    }
                },
                yAxis3D: {
                    type: 'category',
                    name: '시도명',
                    nameGap: 30,
                    data: categories
                },
                zAxis3D: {
                    type: 'value',
                    name: '밀도',
                    nameGap: 20
                },
                series: ridgelineData.map((data, index) => ({
                    type: 'surface',
                    wireframe: {
                        show: false
                    },
                    parametricEquation: {
                        u: { min: -4, max: 4, step: 0.1 },
                        v: { min: 0, max: 1, step: 0.05 },
                        x: function(u, v) {
                            // 가상의 분포를 표현하기 위해 확률 밀도 함수를 사용
                            const mean = rawData[index].value;
                            const stdDev = rawData[index].value * 0.1;
                            return u * stdDev + mean;
                        },
                        y: function(u, v) {
                            return index; // Y축(시도명)을 고정
                        },
                        z: function(u, v) {
                            // 정규분포의 확률 밀도 함수를 기반으로 산 모양을 생성
                            const stdDev = rawData[index].value * 0.1;
                            const density = (1 / (stdDev * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow(u, 2));
                            return density * v * 150000;
                        }
                    },
                    itemStyle: {
                        color: `hsl(${index * 360 / ridgelineData.length}, 70%, 50%)`
                    }
                }))
            };
            myChart.setOption(ridgelineOption, true);
        }
        
        // 초기 로드 시 버블 차트 표시
        showBubbleChart();

    </script>
</body>
</html>